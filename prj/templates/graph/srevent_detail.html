{% extends 'graph/srevent_base.html' %}
{% load static %}

{% block header %}
<title>{{ object.title }}</title>
{% endblock %}

{% block container %}
<div class="row my-4">
  <div class="col">
    <div class="card border-dark">
      <div class="card-header bg-dark text-light align-middle">
        <i class="fa-solid fa-chart-line me-3"></i><span class="h5">{{ object.title }}{{ object.get_badge|safe }}</span>
      </div>
      <div class="card-body px-0 py-2">
        <div id="chart_wrapper" class="overflow-x-hidden" style="width: 100%;">
          <div class="d-none d-md-block">
            <canvas id="myChartLarge" width="1000" height="500"></canvas>
          </div>
          <div class="d-md-none d-block" style="width: 200%;">
            <canvas id="myChartSmall" width="400" height="250"></canvas>
          </div>
        </div>
      </div>
      <div class="card-footer">
        <span class="text-secondary small">{{ object.remark|linebreaksbr}}</span>
      </div>
    </div>
  </div>
</div>
<div class="row my-4">
        <div class="col">
          <div class="card border-dark">
            <div class="card-header bg-dark text-light">
              <span class="h5"><i class="fa-solid fa-ranking-star me-3"></i>Ranking</span>
              <span class="small ms-2">{{ object.last_watch_dt }}現在</span>
            </div>
            <div class="card-body p-0">
              <table class="table table-sm table-striped">
                <tr>
                  <th></th>
                  <th>ルーム名</th>
                  <th>ポイント</th>
                  <th class="align-middle small text-secondary">変動(1時間)</th>
                </tr>
                {% for room in object.room_ranking %}
                <tr>
                  <td class="align-middle text-center">
                    {% if forloop.counter == 1 %}
                    <span class="badge bg-warning rounded">{{ forloop.counter }}</span>
                    {% elif forloop.counter == 2 %}
                    <span class="badge bg-secondary rounded">{{ forloop.counter }}</span>
                    {% elif forloop.counter == 3 %}
                    <span class="badge bg-danger rounded">{{ forloop.counter }}</span>
                    {% else %}
                    <span class="badge text-dark">{{ forloop.counter }}</span>
                    {% endif %}
                  </td>
                  <td class="align-middle">{{ room.name }}</td>
                  <td class="align-middle">{{ room.last_point }} pt</td>
                  <td class="align-middle text-secondary small">+ {{ room.point_increment }} pt</td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="4">
                    表示できるルームがありません。
                  </td>
                <tr>
                {% endfor %}
              </table>
            </div>
          </div>
        </div>
{% endblock %}

{% block script %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-colorschemes"></script>
<script>
  var labels = {{ object.schedule_json|safe }};
  var chartl = document.getElementById('myChartLarge');
  var charts = document.getElementById('myChartSmall');
  var ctxl = chartl.getContext('2d');
  var ctxs = charts.getContext('2d');
  var data = {
    "type": "line",
    "data": {
      "labels": labels,
      "datasets": {{ object.make_datasets|safe }},
    },
    "options":{
     "legend": {
         "position": "bottom",
         "labels": {
           "boxWidth": 20
         }
      },
      "plugins": {
        "colorschemes": {
          "scheme": "tableau.Classic20"
        }
      }
    }
  }
  var myChart = new Chart(ctxl, data);
  var myChart = new Chart(ctxs, data);
  var chartWrapper = document.getElementById('chart_wrapper');
  chartWrapper.style.overflow = "auto";
</script>
{% endblock %}
